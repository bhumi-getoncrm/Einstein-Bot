<!DOCTYPE html>
<html>
<head>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jsforce/1.9.1/jsforce.min.js"></script>
  <script>
    jsforce.browser.init({
      loginUrl: 'https://login.salesforce.com',
      clientId: '3MVG9pRzvMkjMb6kBymhP55a2BB7TMIMw3St73GYnnGWpIdYp7Z7_ay21rUJXnu2.hEyb0IKOgaEnQ4dNQW8k',
      redirectUri: 'https://bhumigothi.github.io/Einstein-Bot/FileExtract.html'
    });
     jsforce.browser.on('connect', function(conn) {
        fetchDoc(conn);
     });
    async function fetchDoc(conn){
      conn.query("SELECT Id, Name, Body, ContentType from Attachment where ParentId IN( SELECT Id FROM account where name like '%b2b%')", function(err, res) {
        if (err) { return console.error(err); }
          res.records.forEach(record => {
          const response = await conn
          .sobject('Attachment')
          .retrieve(record.Id);
          //.catch(handleConnectionError);

        // we use fetch instead of jsforce.Connection.retrieve because jsforce
        // can return a garbled string when downloading images
        const fetchResponse = await fetch(`${conn.instanceUrl}/${response.Body}`, {
          headers: { Authorization: `Bearer ${conn.accessToken}` },
        });

        const blob = await fetchResponse.blob();

        var a = document.createElement("a");
        document.body.appendChild(a);
        a.style = "display: none";
        url = window.URL.createObjectURL(blob);
            a.href = url;
            a.download = record.Name + _ + record.ParentId;
            a.click();
            window.URL.revokeObjectURL(url);
    });
  }
  </script>
</head>
<body>
  <button onclick="javascript:jsforce.browser.login();">Login</button>
</body>
</html>
